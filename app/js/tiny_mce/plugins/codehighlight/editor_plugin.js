(function(){tinymce.PluginManager.requireLangPack("codehighlight");tinymce.create("tinymce.plugins.CodeHighLight",{init:function(a,b){var c=this;c.editor=a;a.addCommand("mceCodeHighLight",function(){a.windowManager.open({file:b+"/dialog.htm",width:450+parseInt(a.getLang("codehighlight.delta_width",0)),height:400+parseInt(a.getLang("codehighlight.delta_height",0)),inline:1},{plugin_url:b,some_custom_arg:"custom arg"})});a.addButton("codehighlight",{title:"codehighlight.desc",cmd:"mceCodeHighLight",image:b+"/img/codehighlight.png"});a.onNodeChange.add(function(e,d,f){d.setActive("codehighlight",f.nodeName=="IMG")});a.onInit.add(function(d){d.dom.loadCSS(b+"/css/codeditor.css")});if(tinymce.isIE||tinymce.isWebKit){a.onKeyDown.add(function(f,h){var d;var g=f.selection;if(h.keyCode==13&&g.getNode().nodeName==="PRE"){g.setContent('<br id="__codehighlight" /> ',{format:"raw"});d=f.dom.get("__codehighlight");d.removeAttribute("id");g.select(d);g.collapse();return tinymce.dom.Event.cancel(h)}})}if(tinymce.isGecko||tinymce.isOpera){a.onKeyDown.add(function(d,g){var f=d.selection;if(g.keyCode==9&&f.getNode().nodeName==="PRE"){f.setContent("\t",{format:"raw"});return tinymce.dom.Event.cancel(g)}})}if(tinymce.isGecko){a.onSetContent.add(function(d,e){c._replaceNewlinesWithBrElements(d)})}a.onPreProcess.add(function(d,f){c._replaceBrElementsWithNewlines(d,f.node);if(tinymce.isWebKit){c._removeSpanElementsInPreElementsForWebKit(d,f.node)}var e=d.dom.get("__codehighlightFixTooltip");d.dom.remove(e)})},_nl2br:function(a){var d=this;if(!(d.escape&&d.unescape)){var c={_:function(e){var f=c[e];if(!f){if(e.length-1){f=String.fromCharCode(e.substring(e.length-3?2:1))}else{var g=e.charCodeAt(0);f=g<256?"%"+(0+g.toString(16)).slice(-2).toUpperCase():"%u"+("000"+g.toString(16)).slice(-4).toUpperCase()}c[f]=e;c[e]=f}return f}};d.escape=d.escape||function(e){return e.replace(/[^\w @\*\-\+\.\/]/g,function(f){return c._(f)})};d.unescape=d.unescape||function(e){return e.replace(/%(u[\da-f]{4}|[\da-f]{2})/gi,function(f){return c._(f)})}}a=d.escape(a);var b;if(a.indexOf("%0D%0A")>-1){b=/%0D%0A/g}else{if(a.indexOf("%0A")>-1){b=/%0A/g}else{if(a.indexOf("%0D")>-1){b=/%0D/g}}}if(typeof(b)=="undefined"){return d.unescape(a)}else{return d.unescape(a.replace(b,"<br/>"))}},_replaceNewlinesWithBrElements:function(a){var c=this;var d=a.dom.select("pre");for(var b=0;b<d.length;b++){d[b].innerHTML=c._nl2br(d[b].innerHTML)}},_replaceBrElementsWithNewlines:function(d,f){var b=d.dom.select("pre br",f);var a=tinymce.isIE?"\r":"\n";var c;for(var e=0;e<b.length;e++){c=d.getDoc().createTextNode(a);d.dom.insertAfter(c,b[e]);d.dom.remove(b[e])}},_removeSpanElementsInPreElementsForWebKit:function(b,d){var a=b.dom.select("pre span",d);var e;for(var c=0;c<a.length;c++){e=b.getDoc().createTextNode(a[c].innerHTML);b.dom.insertAfter(e,a[c]);b.dom.remove(a[c])}},createControl:function(b,a){return null},getInfo:function(){return{longname:"Code Highlight",author:"Gerits Aurelien",authorurl:"http://www.magix-dev.be",infourl:"http://www.magix-cjquery.com",version:"1.2"}}});tinymce.PluginManager.add("codehighlight",tinymce.plugins.CodeHighLight)})();